// ===========================================
// COMMENTS DATA
// ===========================================
const commentsData = [
    {
        "id": 1,
        "name": "Luis Mario",
        "rating": 5,
        "date": "16/09/2025",
        "comment": "Muy buen pack, super accesible para todo lo que incluye"
    },
    {
        "id": 2,
        "name": "Evelin Jazmin",
        "rating": 5,
        "date": "15/5/2025",
        "comment": "Yo uso Autodesk Inventor y aun que las piezas no las pude abrir, los planos en pdf me han parecido exelentes para practicar, ya tengo conocimientos sobre el programa, pero en mis ratitos libres me gusta practicar y que mejor que con estos planos que están muy completos, me ha parecido una muy buena inversión"
    },
    {
        "id": 3,
        "name": "Luis Felipe Lazaro Lopez",
        "rating": 5,
        "date": "14/5/2025",
        "comment": "Me parece interesante"
    },
    {
        "id": 4,
        "name": "sergio",
        "rating": 5,
        "date": "12/5/2025",
        "comment": "ok"
    },
    {
        "id": 5,
        "name": "sergio",
        "rating": 5,
        "date": "8/5/2025",
        "comment": ""
    },
    {
        "id": 6,
        "name": "Ernesto Silva Mendoza",
        "rating": 5,
        "date": "27/4/2025",
        "comment": "Muy buenos por lo que veo, solo falta inciar y practicar son solidworks."
    },
    {
        "id": 7,
        "name": "Marcos",
        "rating": 5,
        "date": "10/4/2025",
        "comment": "Esta bien para practicar y aprender"
    },
    {
        "id": 8,
        "name": "Braulio Sánchez Espinosa",
        "rating": 4.5,
        "date": "7/4/2025",
        "comment": "Me parece muy bien paquete, muy buena calidad y sobretodo muy prácticos.\nMe gustaría poder tener más planos, ya que la publicidad indica x, cantidad de ejercicios."
    },
    {
        "id": 9,
        "name": "Angel Martinez Zavala",
        "rating": 5,
        "date": "4/4/2025",
        "comment": "Aun no inicio el curso pero los planos se ven muy bien"
    },
    {
        "id": 10,
        "name": "eleazar castillo",
        "rating": 4.5,
        "date": "2/4/2025",
        "comment": "me gusta para practicar y mejorar"
    },
    {
        "id": 11,
        "name": "rcuevas",
        "rating": 4,
        "date": "31/3/2025",
        "comment": ""
    },
    {
        "id": 12,
        "name": "Viviana Almeda",
        "rating": 5,
        "date": "29/3/2025",
        "comment": "Nuestro profe tambien nos pone tus videos y ejercicios 👍, los compré por que los queria todos completos"
    },
    {
        "id": 13,
        "name": "Santiago Alexander",
        "rating": 5,
        "date": "26/3/2025",
        "comment": "al final el programa no me funcionó, me falto un paso, pero me ayudaron a repararlo, cuando termine el curso gratuito sin duda me inscribiré al de pago, muchas gracias"
    },
    {
        "id": 14,
        "name": "Juan Ortiz Anguiano",
        "rating": 5,
        "date": "26/3/2025",
        "comment": "Muy bueno"
    },
    {
        "id": 15,
        "name": "Octavio Ibarra Soto",
        "rating": 5,
        "date": "24/3/2025",
        "comment": ""
    },
    {
        "id": 16,
        "name": "Erik Daniel",
        "rating": 5,
        "date": "23/3/2025",
        "comment": "Tenia semanas intentando conseguir el programa, y aquí pude instalarlo muy facil, el material es muy bueno para ir empezando, tienen muy buena calidad"
    },
    {
        "id": 17,
        "name": "Pablo",
        "rating": 5,
        "date": "22/3/2025",
        "comment": "😲 El profe de la uni dijo que le habian costado 500 pesos, y nos pidió cooperación, de haber sabido los hubiera comprado yo, si muy buen material"
    },
    {
        "id": 18,
        "name": "carlos lerzo",
        "rating": 5,
        "date": "6/3/2025",
        "comment": "muy bueno"
    },
    {
        "id": 19,
        "name": "Kevin",
        "rating": 5,
        "date": "29/2/2025",
        "comment": "Los pueden variar?"
    },
    {
        "id": 20,
        "name": "Isaac Cereceres Pinedo",
        "rating": 4,
        "date": "24/1/2025",
        "comment": ""
    },
    {
        "id": 21,
        "name": "Nicole López",
        "rating": 5,
        "date": "23/1/2025",
        "comment": "Excelente curso"
    },
    {
        "id": 22,
        "name": "jesus",
        "rating": 5,
        "date": "13/12/2024",
        "comment": "esta super cool el curso estoy aprendiendo mas de lo que e aprendido en la escuela"
    },
    {
        "id": 23,
        "name": "Edwin",
        "rating": 5,
        "date": "12/12/2024",
        "comment": ""
    },
    {
        "id": 24,
        "name": "Alondra",
        "rating": 5,
        "date": "22/11/2024",
        "comment": "Muy buenos, me sirvieron mucho para practicar"
    },
    {
        "id": 25,
        "name": "Miguel Angel",
        "rating": 5,
        "date": "19/11/2024",
        "comment": "alucinante"
    },
    {
        "id": 26,
        "name": "Marcos ECHEVESTE",
        "rating": 4.5,
        "date": "11/11/2024",
        "comment": "muy buen paquete de piezas"
    },
    {
        "id": 27,
        "name": "Leandro Grill",
        "rating": 5,
        "date": "10/11/2024",
        "comment": "Excelente material. Muy interesantes, prácticos y completos."
    },
    {
        "id": 28,
        "name": "Victor",
        "rating": 5,
        "date": "31/10/2024",
        "comment": "Muy buena calidad y muy completos"
    },
    {
        "id": 29,
        "name": "Victor",
        "rating": 5,
        "date": "31/10/2024",
        "comment": "Muy buena calidad y completos"
    },
    {
        "id": 30,
        "name": "Mirko",
        "rating": 5,
        "date": "30/10/2024",
        "comment": "Descargue los ejercicios gratis y me fueron muy utiles, este paquete parece muy prometedor"
    },
    {
        "id": 31,
        "name": "Jorge abraham",
        "rating": 5,
        "date": "29/10/2024",
        "comment": "Excelente  calidad"
    },
    {
        "id": 32,
        "name": "Jesús",
        "rating": 5,
        "date": "26/10/2024",
        "comment": "La verdad esta super genial el paquete de ejercicios quiero aprender mucho más"
    },
    {
        "id": 33,
        "name": "Federico Campos",
        "rating": 5,
        "date": "22/10/2024",
        "comment": "Excelentes"
    },
    {
        "id": 34,
        "name": "Noriega Azcona Donovan Jessus",
        "rating": 5,
        "date": "15/10/2024",
        "comment": "Muy util y tambien muy bien explicado los videos"
    },
    {
        "id": 35,
        "name": "ANGEL ROLANDO VALLEJO ALMANZA",
        "rating": 5,
        "date": "14/10/2024",
        "comment": "LLEVO DOS DIAS CON EL PAQUETE Y ME HA GUSTADO, MUCHAS GRACIAS EN UNOS DIAS ESPERO REGISTRARME EN SU CURSO."
    },
    {
        "id": 36,
        "name": "Jose Gamez",
        "rating": 5,
        "date": "14/10/2024",
        "comment": "Excelente!"
    },
    {
        "id": 37,
        "name": "Erika",
        "rating": 4.5,
        "date": "9/10/2024",
        "comment": "Por el momento bueno"
    },
    {
        "id": 38,
        "name": "Santiago Vázquez Vera",
        "rating": 5,
        "date": "28/9/2024",
        "comment": "es muy bueno, lo recomiendo"
    },
    {
        "id": 39,
        "name": "Santiago Vazquez Vera",
        "rating": 5,
        "date": "27/9/2024",
        "comment": "es muy bueno, lo recomiendo demasiado"
    },
    {
        "id": 40,
        "name": "Alejandro Hernandez Jimenez",
        "rating": 5,
        "date": "21/9/2024",
        "comment": ""
    },
    {
        "id": 41,
        "name": "María Isabel",
        "rating": 5,
        "date": "18/9/2024",
        "comment": "Me ha gustado la calidad que tienen, si son de mucha ayuda, ya que se me complica a veces el programa y me gusta que trae la masa de la pieza para comprobarlas"
    },
    {
        "id": 42,
        "name": "Oswaldo Cantú",
        "rating": 5,
        "date": "17/9/2024",
        "comment": "Me parecen excelentes para practicar. De gran calidad y de gran valor academico."
    },
    {
        "id": 43,
        "name": "José Humberto",
        "rating": 5,
        "date": "14/9/2024",
        "comment": "Está muy bien la verdad, espero aprender más con estos planos"
    },
    {
        "id": 44,
        "name": "carlos",
        "rating": 5,
        "date": "14/9/2024",
        "comment": "me fue de mucha ayuda"
    },
    {
        "id": 45,
        "name": "César Roberto Saenz Alvidrez",
        "rating": 5,
        "date": "13/9/2024",
        "comment": "Me gusto"
    },
    {
        "id": 46,
        "name": "Alejandro",
        "rating": 4,
        "date": "24/5/2025",
        "comment": "esta chido"
    },
    {
        "id": 47,
        "name": "isaac ceereceres",
        "rating": 5,
        "date": "8/6/2024",
        "comment": "son muy buenos cursos ya que Diego tiena una manera muy clara de explicar las cosas, por lo que es muy facil aprender viendo"
    },
    {
        "id": 48,
        "name": "Jaime Coronel",
        "rating": 5,
        "date": "10/9/2024",
        "comment": "Excelente  Material"
    },
    {
        "id": 49,
        "name": "cristhian",
        "rating": 5,
        "date": "7/10/2024",
        "comment": ""
    },
    {
        "id": 50,
        "name": "Miguel Gabriel Coria Acosta",
        "rating": 5,
        "date": "30/4/2025",
        "comment": "Excelente material"
    },
    {
        "id": 51,
        "name": "Eduardo",
        "rating": 4.5,
        "date": "26/5/2025",
        "comment": "Sugiero haya más videos de cada pieza."
    }
];

// ===========================================
// UTILITY FUNCTIONS
// ===========================================
function getInitials(name) {
    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
}

function createStars(rating) {
    let stars = '';
    for (let i = 1; i <= 5; i++) {
        stars += i <= rating ? '★' : '☆';
    }
    return stars;
}

function formatDate(dateString) {
    return dateString;
}

function calculateOverallRating(comments) {
    if (comments.length === 0) return 0;
    const total = comments.reduce((sum, comment) => sum + comment.rating, 0);
    return (total / comments.length).toFixed(1);
}

// ===========================================
// RENDER FUNCTIONS
// ===========================================
let commentsLoaded = false; // Bandera para cargar solo una vez

function renderComments() {
    if (commentsLoaded) return; // Evitar cargar múltiples veces
    commentsLoaded = true;
    
    const container = document.getElementById('commentsContainer');
    const loading = document.getElementById('loading');
    
    // Simulate loading
    setTimeout(() => {
        loading.style.display = 'none';
        
        // Update summary
        const overallRating = calculateOverallRating(commentsData);
        document.getElementById('overallRating').textContent = overallRating;
        document.getElementById('overallStars').textContent = createStars(Math.round(parseFloat(overallRating)));
        document.getElementById('totalReviews').textContent = `${commentsData.length} reseña${commentsData.length !== 1 ? 's' : ''}`;

        // Render comments
        if (commentsData.length === 0) {
            container.innerHTML = '<div class="no-comments">No hay comentarios disponibles</div>';
            return;
        }

        container.innerHTML = commentsData.map(comment => `
            <div class="comment fade-in">
                <div class="comment-header">
                    <div class="user-info">
                        <div class="user-avatar">${getInitials(comment.name)}</div>
                        <div class="user-details">
                            <h3>${comment.name}</h3>
                            <div class="comment-date">${formatDate(comment.date)}</div>
                        </div>
                    </div>
                    <div class="comment-rating">
                        <span class="stars">${createStars(comment.rating)}</span>
                        <span class="rating-value">${comment.rating}</span>
                    </div>
                </div>
                <div class="comment-text">${comment.comment || 'Sin comentario adicional'}</div>
            </div>
        `).join('');
    }, 500);
}

// ===========================================
// LAZY LOADING - INTERSECTION OBSERVER
// ===========================================
function initLazyLoadComments() {
    const reviewsSection = document.querySelector('.reviews-section');
    
    if (!reviewsSection) {
        console.error('No se encontró la sección de reviews');
        return;
    }

    // Configurar el Intersection Observer
    const observerOptions = {
        root: null, // viewport
        rootMargin: '200px', // Cargar 200px antes de que sea visible
        threshold: 0.1 // 10% visible
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting && !commentsLoaded) {
                console.log('Sección de comentarios visible, cargando...');
                renderComments();
                observer.unobserve(reviewsSection); // Dejar de observar después de cargar
            }
        });
    }, observerOptions);

    // Empezar a observar la sección de reviews
    observer.observe(reviewsSection);
}

// ===========================================
// INITIALIZATION
// ===========================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM cargado, iniciando lazy load...');
    initLazyLoadComments();
});
